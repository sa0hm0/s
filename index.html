<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مواقيت الصلاة والقرآن الكريم</title>
  <link rel="icon" href="https://media.discordapp.net/attachments/1316731095391277066/1385612672816513116/raw.png">
  <style>
    /* ========== Base ========== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #f4f9f4;
      font-family: Arial, sans-serif;
      color: #0a3d24;
      text-align: center;
      padding-bottom: 40px;
    }
    header {
      position: relative;
      background: #0a3d24 url("https://media.discordapp.net/attachments/1316731095391277066/1385612664574574732/raw.png")
        center/cover no-repeat;
      padding: 60px 20px; color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #siteLogo {
      position: absolute; top: 20px; left: 20px;
      width: 60px; height: auto;
    }
    header h1 {
      font-size: 1.8rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
    }
    #menuBtn {
      position: absolute; top: 20px; right: 20px;
      font-size: 1.8rem; background: none; border: none; color: #fff;
      cursor: pointer;
    }
    #sideMenu {
      position: fixed; top: 0; right: -260px;
      width: 240px; height: 100vh;
      background: #033e1b; padding-top: 60px;
      text-align: right; transition: right .3s; z-index: 1000;
    }
    #sideMenu a {
      display: block; padding: 12px 20px;
      color: #fff; text-decoration: none;
      border-bottom: 1px solid #045d38;
    }
    #sideMenu a:hover { background: #045d38; }

    .box {
      display: none;
      max-width: 900px; margin: 20px auto;
      padding: 20px; background: #fff;
      border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: right; line-height: 1.6;
    }
    .box h2 {
      display: inline-block;
      margin-bottom: 15px; padding-bottom: 5px;
      border-bottom: 2px solid #0a3d24;
      font-size: 1.3rem;
    }

    /* ========= Controls & Grid ========= */
    .controls {
      margin: 15px 0;
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 8px;
    }
    .controls select,
    .controls input,
    .controls button {
      padding: 8px;
      border: 1px solid #0a3d24;
      border-radius: 4px;
      font-size: .9rem;
    }
    .controls button {
      background: #0a3d24; color: #fff; cursor: pointer;
    }
    .controls button:hover { background: #08301c; }

    /* ========= Prayer Times ========= */
    .times {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
      gap: 12px; margin-top: 15px;
    }
    .times div {
      display: flex; justify-content: space-between;
      font-size: .95rem;
    }
    #nextCountdown {
      margin-top: 12px;
      font-weight: bold; color: #d35400;
    }

    /* ========= Cards (Countdowns) ========= */
    #countdowns .card {
      background: #fff; border: 1px solid #ddd;
      border-radius: 8px; padding: 15px;
      margin: 10px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    #countdowns .card h3 {
      margin-bottom: 8px; color: #045d38; font-size: 1rem;
    }
    #countdowns .card p {
      font-size: .95rem; line-height: 1.4;
    }

    /* ========= Quran Reader ========= */
    #searchContainer {
      margin-bottom: 15px;
    }
    #searchContainer input {
      padding: 6px 10px; width: 60%;
      border: 1px solid #0a3d24; border-radius: 4px;
    }
    #searchContainer button {
      padding: 6px 12px;
      background: #0a3d24; color: #fff;
      border: none; cursor: pointer; border-radius: 4px;
    }
    #khatmNav {
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 6px;
      margin-bottom: 12px; overflow-x: auto;
    }
    #khatmNav button {
      padding: 6px 10px;
      border: 1px solid #0a3d24;
      background: #fff; cursor: pointer; border-radius: 4px;
    }
    #khatmNav button.active {
      background: #0a3d24; color: #fff;
    }
    #quranView {
      height: 500px; overflow-y: auto;
      padding: 12px; border: 1px solid #ccc;
      border-radius: 4px; text-align: right; line-height: 1.6;
    }

    /* ========= Responsive ========= */
    @media(max-width:600px) {
      .times { grid-template-columns: 1fr; }
      #searchContainer input { width: 100%; margin-bottom: 8px; }
      #sideMenu { width: 70%; }
    }
  </style>
</head>
<body>

  <!-- ======== Header & Menu ======== -->
  <header>
    <img id="siteLogo" src="https://media.discordapp.net/attachments/1316731095391277066/1385612672816513116/raw.png" alt="لوجو">
    <h1>مواقيت الصلاة والقرآن الكريم</h1>
    <button id="menuBtn">☰</button>
    <nav id="sideMenu">
      <a href="#" data-page="home">الصفحة الرئيسية</a>
      <a href="#" data-page="adhkar">أذكار</a>
      <a href="#" data-page="duas">أدعية</a>
      <a href="#" data-page="qibla">القبلة</a>
      <a href="#" data-page="countdowns">مؤاقت</a>
      <a href="#" data-page="khatmReader">القرآن الكريم</a>
    </nav>
  </header>

  <!-- ======== الصفحة الرئيسية ======== -->
  <div id="home" class="box">
    <h2>الصفحة الرئيسية</h2>
    <div class="controls">
      <select id="citySelect">
        <option value="">— اختر المدينة —</option>
        <option value="Mecca|Saudi Arabia">مكة المكرمة</option>
        <option value="Medina|Saudi Arabia">المدينة المنورة</option>
        <option value="Cairo|Egypt">القاهرة</option>
        <option value="Istanbul|Turkey">إسطنبول</option>
        <option value="London|United Kingdom">لندن</option>
        <option value="Dubai|United Arab Emirates">دبي</option>
        <option value="Jakarta|Indonesia">جاكرتا</option>
        <option value="Custom">مخصص...</option>
      </select>
      <input type="text" id="customCity" placeholder="المدينة" style="display:none;">
      <input type="text" id="customCountry" placeholder="الدولة" style="display:none;">
      <button id="loadBtn">موافق</button>
    </div>
    <div id="timesBox" class="box">
      <h2>مواقيت الصلاة</h2>
      <div class="times">
        <div><span>الفجر</span><span id="Fajr">...</span></div>
        <div><span>الشروق</span><span id="Sunrise">...</span></div>
        <div><span>الظهر</span><span id="Dhuhr">...</span></div>
        <div><span>العصر</span><span id="Asr">...</span></div>
        <div><span>المغرب</span><span id="Maghrib">...</span></div>
        <div><span>العشاء</span><span id="Isha">...</span></div>
      </div>
      <p id="nextCountdown"></p>
    </div>
  </div>

  <!-- ======== الأذكار ======== -->
  <div id="adhkar" class="box">
    <h2>أذكار الصباح</h2>
    <ul id="morningList"></ul>
    <h2>أذكار المساء</h2>
    <ul id="eveningList"></ul>
    <h2>أذكار عامة</h2>
    <ul id="generalList"></ul>
  </div>

  <!-- ======== الأدعية ======== -->
  <div id="duas" class="box">
    <h2>أدعية متنوعة</h2>
    <select id="duasSelect">
      <option value="">— اختر دعاء —</option>
      <option value="rain">دعاء نزول المطر</option>
      <option value="fast">دعاء الإفطار للصائم</option>
      <option value="travel">دعاء السفر</option>
      <option value="istikharah">دعاء الاستخارة</option>
      <option value="morning">دعاء الصباح</option>
      <option value="evening">دعاء المساء</option>
    </select>
    <button id="showDuaBtn">عرض الدعاء</button>
    <ul id="duaText" style="margin-top:10px; text-align:right; line-height:1.6;"></ul>
  </div>

  <!-- ======== القبلة ======== -->
  <div id="qibla" class="box">
    <h2>اتجاه القبلة</h2>
    <div id="compass"></div>
    <p id="mobileOnly">هذه الميزة متاحة في الأجهزة المحمولة</p>
  </div>

  <!-- ======== المؤاقت ======== -->
  <div id="countdowns" class="box">
    <h2>المؤاقت القادمة</h2>
    <div class="card">
      <h3>باقي على رمضان</h3><p id="toRamadan"></p>
    </div>
    <div class="card">
      <h3>باقي على عيد الفطر</h3><p id="toEidFitr"></p>
    </div>
    <div class="card">
      <h3>باقي على عيد الأضحى</h3><p id="toEidAdha"></p>
    </div>
  </div>

  <!-- ======== قسم القرآن الكريم ======== -->
  <div id="khatmReader" class="box">
    <h2>القرآن الكريم</h2>
    <div id="searchContainer">
      <input type="text" id="suraSearch" placeholder="ابحث عن السورة بالاسم">
      <button id="searchBtn">بحث</button>
    </div>
    <div id="khatmNav"></div>
    <div id="quranView">سيظهر نص السورة هنا...</div>
  </div>

  <!-- ======== Script ======== -->
  <script>
    // ======== التنقل ========
    const menuBtn = document.getElementById('menuBtn'),
          sideMenu = document.getElementById('sideMenu'),
          links    = sideMenu.querySelectorAll('a[data-page]'),
          boxes    = document.querySelectorAll('.box');
    menuBtn.onclick = ()=> sideMenu.style.right = sideMenu.style.right==='0px'?'-260px':'0px';
    links.forEach(l=>{
      l.onclick = e=>{
        e.preventDefault();
        boxes.forEach(b=> b.id===l.dataset.page ? b.style.display='block' : b.style.display='none');
        sideMenu.style.right='-260px';
      }
    });
    links[0].click();

    // ======== أذكار ========
    const morning=['أصبحنا وأصبح الملك لله','رضيت بالله ربا','اللهم بك أصبحنا'];
    const evening=['أمسينا وأمسى الملك لله','رضيت بالله ربا','اللهم بك أمسينا'];
    const general=['سبحان الله','الحمد لله','لا إله إلا الله','الله أكبر'];
    [['morningList',morning],['eveningList',evening],['generalList',general]]
      .forEach(([id,arr])=>{
        const ul = document.getElementById(id);
        arr.forEach(txt=>{
          const li=document.createElement('li');
          li.textContent=txt; ul.append(li);
        });
      });

    // ======== أدعية ========
    const duaList = {
      rain:['اللهم صيبًا نافعًا','اللهم اسقنا الغيث ولا تجعلنا من القانطين'],
      fast:['اللهم إني لك صمت وبك آمنت وعليك توكلت وعلى رزقك أفطرت'],
      travel:['سبحان الذي سخر لنا هذا وما كنا له مقرنين وإنا إلى ربنا لمنقلبون'],
      istikharah:['اللهم إني أستخيرك بعلمك واستقدرك بقدرتك واسألك من فضلك العظيم'],
      morning:['اللهم بك أصبحنا وبك أمسينا وبك نحيا وبك نموت وإليك المصير'],
      evening:['اللهم بك أمسينا وبك أصبحنا وبك نحيا وبك نموت وإليك المصير']
    };
    document.getElementById('showDuaBtn').onclick = ()=>{
      const out = document.getElementById('duaText');
      out.innerHTML='';
      (duaList[document.getElementById('duasSelect').value]||[])
        .forEach(txt=>{
          const li=document.createElement('li');
          li.textContent=txt; out.append(li);
        });
    };

    // ======== القبلة ========
    if('DeviceOrientationEvent' in window) {
      document.getElementById('compass').style.display='block';
      window.addEventListener('deviceorientation',e=>{
        document.getElementById('compass').style.transform = `rotate(${- (e.alpha||0)}deg)`;
      });
    } else document.getElementById('mobileOnly').style.display='block';

    // ======== مواقيت الصلاة ========
    const timesEls = ['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha']
      .reduce((o,k)=>(o[k]=document.getElementById(k),o),{});
    let currentTZ='';
    async function loadTimings(lat,lon,city,country){
      let url;
      if(lat!=null){
        url = `https://api.aladhan.com/v1/timings/${Math.floor(Date.now()/1000)}?latitude=${lat}&longitude=${lon}&method=2`;
      } else {
        url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=2`;
      }
      const j = await fetch(url).then(r=>r.json());
      currentTZ = j.data.meta.timezone;
      Object.entries(j.data.timings).forEach(([k,v])=>{
        let [h,m] = v.split(':').map(n=>parseInt(n));
        timesEls[k].textContent = `${h%12||12}:${String(m).padStart(2,'0')}`;
      });
      startNextFriday();
    }
    // جلب بالإحداثيات
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        loadTimings(pos.coords.latitude,pos.coords.longitude);
      },()=>{/* failed */});
    }
    // زر تحديث
    document.getElementById('loadBtn').onclick = ()=>{
      const sel = document.getElementById('citySelect').value;
      if(sel==='Custom'){
        const city=document.getElementById('customCity').value.trim(),
              ct=document.getElementById('customCountry').value.trim();
        if(!city||!ct) return alert('أدخل المدينة والدولة');
        loadTimings(null,null,city,ct);
      } else {
        const [city,ct] = sel.split('|');
        loadTimings(null,null,city,ct);
      }
    };
    document.getElementById('citySelect').onchange = ()=>{
      const isC = document.getElementById('citySelect').value==='Custom';
      document.getElementById('customCity').style.display    = isC?'inline-block':'none';
      document.getElementById('customCountry').style.display = isC?'inline-block':'none';
    };

    // ======== عدّاد الجمعة ========
    function startNextFriday(){
      const out = document.getElementById('nextCountdown');
      (function upd(){
        const now   = new Date().toLocaleString('en-US',{timeZone:currentTZ}),
              d     = new Date(now),
              ahead = ((5 - d.getDay())+7)%7||7,
              tgt   = new Date(d);
        tgt.setDate(d.getDate()+ahead); tgt.setHours(12,0,0,0);
        let diff = tgt - d;
        const days = Math.floor(diff/86400000); diff %= 86400000;
        const hrs  = Math.floor(diff/3600000); diff %= 3600000;
        const mins = Math.floor(diff/60000); diff %= 60000;
        const secs = Math.floor(diff/1000);
        out.textContent = `باقي على الجمعة: ${days>0?days+'ي ':''}${hrs}س ${mins}د ${secs}ث`;
        setTimeout(upd,1000);
      })();
    }

    // ======== المؤاقت (رمضان و الأعياد) ========
    const toRamadan = document.getElementById('toRamadan'),
          toEidFitr = document.getElementById('toEidFitr'),
          toEidAdha = document.getElementById('toEidAdha');
    const dr = new Date('2026-02-10T00:00:00'),
          df = new Date('2026-03-11T00:00:00'),
          da = new Date('2026-06-16T00:00:00');
    function updateCountdowns(){
      const now=new Date();
      [[dr,toRamadan],[df,toEidFitr],[da,toEidAdha]].forEach(([t,el])=>{
        let diff=t-now;
        if(diff<0) return el.textContent='انتهى';
        const dTot=Math.floor(diff/86400000),
              M    =Math.floor(dTot/30),
              D    =dTot%30;
        diff%=86400000;
        const H=Math.floor(diff/3600000),
              m=Math.floor((diff%3600000)/60000),
              s=Math.floor((diff%60000)/1000);
        el.textContent=`${M}ش ${D}ي ${H}س ${m}د ${s}ث`;
      });
    }
    setInterval(updateCountdowns,1000);
    updateCountdowns();

    // ======== قارئ القرآن الكريم ========
    const khatmNav = document.getElementById('khatmNav'),
          qView    = document.getElementById('quranView'),
          suraNames = [
            "الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف",
            "الأنفال","التوبة","يونس","هود","يوسف","الرعد","إبراهيم","الحجر","النحل",
            "الإسراء","الكهف","مريم","طه","الأنبياء","الحج","المؤمنون","النور","الفرقان",
            "الشعراء","النمل","القصص","العنكبوت","الروم","لقمان","السجدة","الأحزاب",
            "سبأ","فاطر","يس","الصافات","ص","الزمر","غافر","فصلت","الشورى","الزخرف",
            "الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق","الذاريات","الطور",
            "النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر","الممتحنة",
            "الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم",
            "الحاقة","المعارج","نوح","الجن","المزمل","المدثر","القيامة","الإنسان",
            "المرسلات","النبأ","النازعات","عبس","التكوير","الانفطار","المطففين",
            "الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد","الشمس",
            "الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة",
            "العاديات","القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون",
            "الكوثر","الكافرون","النصر","المسد","الإخلاص","الفلق","الناس"
          ];
    // بناء قائمة السور
    suraNames.forEach((nm,i)=>{
      const btn = document.createElement('button');
      btn.textContent = `${i+1}. ${nm}`;
      btn.onclick = async ()=>{
        khatmNav.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        // جلب نص السورة من ملف JSON خارجي quran/sura{i+1}.json
        try {
          const js = await fetch(`quran/sura${i+1}.json`).then(r=>r.json());
          qView.innerHTML = js.verses.map(v=>`<p>${v}</p>`).join('');
        } catch {
          qView.innerHTML = '<p>خطأ في تحميل نص السورة.</p>';
        }
      };
      khatmNav.append(btn);
    });
    // بحث بالسورة
    document.getElementById('searchBtn').onclick = ()=>{
      const term = document.getElementById('suraSearch').value.trim();
      const idx  = suraNames.findIndex(n=> n.includes(term));
      if(idx<0) return alert('لم تُعثر على سورة بهذا الاسم');
      khatmNav.children[idx].click();
    };
  </script>
</body>
</html>
